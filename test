@Service
public class HealthChecker {

    private final RestTemplate restTemplate;

    @Value("${healthCheck.url}")
    private String healthCheckUrl;

    public HealthChecker(RestTemplate restTemplate) {
        this.restTemplate = restTemplate;
    }

    public HealthStatus checkHealth() {
        try {
            ResponseEntity<String> responseEntity = restTemplate.getForEntity(healthCheckUrl, String.class);
            HttpStatus statusCode = responseEntity.getStatusCode();
            String responseBody = responseEntity.getBody();
            if (statusCode == HttpStatus.OK && responseBody != null) {
                return new HealthStatus("UP");
            } else {
                return new HealthStatus("DOWN");
            }
        } catch (Exception e) {
            return new HealthStatus("DOWN");
        }
    }
}



@RestController
@RequestMapping("/health")
public class HealthController {

    private final HealthChecker healthChecker;

    public HealthController(HealthChecker healthChecker) {
        this.healthChecker = healthChecker;
    }

    @GetMapping
    public ResponseEntity<HealthStatus> getHealthStatus() {
        HealthStatus healthStatus = healthChecker.checkHealth();
        if (healthStatus.getStatus().equals("UP")) {
            return ResponseEntity.ok(healthStatus);
        } else {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(healthStatus);
        }
    }
}
